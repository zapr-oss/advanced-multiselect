"use strict";angular.module("advancedMultiselect",[]),angular.module("advancedMultiselect").directive("checkboxIndeterminate",function(){return{link:function(e,t,n){e.$watch(n.checkboxIndeterminate,function(e){t[0].indeterminate=!!e})}}}).directive("advancedMultiselect",function(e,t){return{restrict:"E",templateUrl:"advancedMultiselect/advancedMultiselect.html",scope:{label:"@",defaultPlaceholder:"=",model:"=",submenuCb:"=",disableStatus:"@"},link:function(n,l,i){var r=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1};e.on("click",function(e){var i=l[0].querySelector(".multiselect-values"),c=e.target;r(i,c)||t(function(){n.showOptions=!1},0)})},controller:function(e,t,n){function l(e,t){e.forEach(function(e){e.isSelected=t,e.children&&l(e.children,t)})}function i(e,t){if(e.children&&e.children.length){for(var n={},l=0;l<e.children.length;l++){var r=i(e.children[l],t);r===o.INDETERMINATE&&(t.val=!0),n[r]?n[r]++:n[r]=1}return n[o.INDETERMINATE]||Object.keys(n).length>1?(e.isIndeterminate=!0,e.isSelected=!1,o.INDETERMINATE):(e.isIndeterminate=!1,e.isSelected=!!n.true,e.isSelected)}return!!e.isSelected}function r(t){for(var n={val:!1},l=0;l<t.length;l++)i(t[l],n);if(n.val)t.isIndeterminate=!0;else if(_.groupBy(t,function(e){return!!e.isIndeterminate}).true)t.isIndeterminate=!0;else{var r=_.groupBy(t,function(e){return!!e.isSelected});Object.keys(r).length>1?t.isIndeterminate=!0:(t.isIndeterminate=!1,e.isSelectAll=!!r.true)}}function c(e){var t=[],n=_.groupBy(e,"isSelected");return n.true=n.true||[],n.true.forEach(function(e){t.push(e.name)}),(n.false||[]).concat(n.undefined||[]).forEach(function(e){if(e.children){var n=_.groupBy(e.children,"isSelected");n.true=n.true||[],n.true.forEach(function(e){t.push(e.name)}),(n.false||[]).concat(n.undefined||[]).forEach(function(e){if(e.children){var n=_.groupBy(e.children,"isSelected");n.true=n.true||[],n.true.forEach(function(e){t.push(e.name)})}})}}),t}function u(){var t=e.$watch("model",function(n,l){if(!angular.equals(n,l)){t(),r(n);var i=c(n);i.length?(e.placeholder=i[0],i.length>1&&(e.placeholder+=" and "+(i.length-1)+" more selected")):e.placeholder=e.defaultPlaceholder,u()}},!0)}e.placeholder=e.defaultPlaceholder;var o={INDETERMINATE:"INDETERMINATE"};e.toggleOptions=function(t){e.showOptions=!e.showOptions,t.stopPropagation()},e.toggleSubLevelOptions=function(t){t.showSubLevels=!t.showSubLevels,"function"==typeof e.submenuCb&&e.submenuCb(t)},e.toggleChildSelections=function(e){var t=!e.isSelected;e.children&&l(e.children,t)},e.toggleSelectAll=function(t){t&&(e.isSelectAll=!e.isSelectAll),l(e.model,e.isSelectAll)},e.init=function(){e.showOptions=!1,u()},e.init()}}});